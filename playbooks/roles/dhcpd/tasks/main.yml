---
- name: Force gather facts
  setup:
  delegate_to: "{{ item }}"
  delegate_facts: true
  loop: "{{ groups['all'] }}"
  when: hostvars[item]['ansible_hostname'] is not defined
  tags:
    - dhcpd_inst
    - dhcpd_conf

- name: Install DHCP server
  yum:
    name: dhcp
    state: present
  notify:
    - Start dhcpd service
    - Enable dhcpd service
  tags: dhcpd_inst

- name: Configure DHCP server
  template:
    src: 'dhcpd_conf.j2'
    dest: /etc/dhcp/dhcpd.conf 
  notify: Restart dhcpd service
  tags: dhcpd_conf
